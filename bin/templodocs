#!/usr/bin/env php
<?php

use Ziumper\Templodocs\Core\CsvReaderBuilder;
use Ziumper\Templodocs\Core\TranslatorService;
use Ziumper\Templodocs\Tempo\TempoJiraParser;
use Ziumper\Templodocs\Tempo\TempoReport;
use Ziumper\Templodocs\Tempo\TempoTranslatorParser;
use Ziumper\Templodocs\WordFileGenerator;

require __DIR__ . '/../vendor/autoload.php';


// Grab CLI arguments
$csv = $argv[1] ?? 'templates/data.csv';           // Default if not passed
$template = $argv[2] ?? 'templates/template.docx'; // Default if not passed
$reportFile = $argv[3] ?? 'report';                // Default if not passed
$translationFrom = $argv[4] ?? null;
$translationTo = $argv[5] ?? null;
$jiraLink = $argv[6] ?? null;


$parsers = [];

if ($translationFrom & $translationTo) {
    $parsers[] = new TempoTranslatorParser(new TranslatorService(), $translationFrom, $translationTo);
}

if ($jiraLink) {
    $parsers[] = new TempoJiraParser($jiraLink);
}


$reader = (new CsvReaderBuilder())->withPath($csv)->build();
$report = new TempoReport($reader, $parsers);

$generator = new WordFileGenerator($template, $reportFile, ["content" => $report->getContent()]);
$generator->generate();

